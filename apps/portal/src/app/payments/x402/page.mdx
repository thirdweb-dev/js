import { ArticleIconCard } from "@doc";
import { ReactIcon, TypeScriptIcon, EngineIcon } from "@/icons";

# x402 Payments

x402 is an open-source protocol that turns the dormant HTTP 402 Payment Required status code into a fully-featured, on-chain payment layer for APIs, websites, and autonomous agents.

Learn more about the protocol at [x402.org](https://x402.org).

<ArticleIconCard
  title="x402 Playground"
  description="Try out x402 payments in our live playground"
  icon={ReactIcon}
  href="https://playground.thirdweb.com/payments/x402"
/>

## Client Side

`wrapFetchWithPayment` wraps the native fetch API to automatically handle `402 Payment Required` responses from any x402-compatible API:

```typescript
import { wrapFetchWithPayment } from "thirdweb/x402";
import { createThirdwebClient } from "thirdweb";
import { createWallet } from "thirdweb/wallets";

const client = createThirdwebClient({ clientId: "your-client-id" });
const wallet = createWallet("io.metamask");
await wallet.connect({ client })

const fetchWithPay = wrapFetchWithPayment(fetch, client, wallet);

// Make a request that may require payment
const response = await fetchWithPay('https://api.example.com/paid-endpoint');
```

## Server Side

To make your API calls payable, use the `settlePayment` function in a middleware or endpoint:

```typescript
import { createThirdwebClient } from "thirdweb";
import { facilitator, settlePayment } from "thirdweb/x402";
import { arbitrumSepolia } from "thirdweb/chains";

const client = createThirdwebClient({ secretKey: "your-secret-key" });
const thirdwebX402Facilitator = facilitator({
  client,
  serverWalletAddress: "0xYourWalletAddress",
});

export async function GET(request: Request) {
  const paymentData = request.headers.get("x-payment");

  const result = await settlePayment({
    resourceUrl: "https://api.example.com/premium-content",
    method: "GET",
    paymentData,
    payTo: "0xYourWalletAddress",
    network: arbitrumSepolia,
    price: "$0.01",
    facilitator: thirdwebX402Facilitator,
    routeConfig: {
      description: "Access to premium API content",
      mimeType: "application/json",
      maxTimeoutSeconds: 300,
    },
  });

  if (result.status === 200) {
    return Response.json({ data: "premium content" });
  } else {
    return Response.json(result.responseBody, {
      status: result.status,
      headers: result.responseHeaders,
    });
  }
}
```

## Going Further

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
  <ArticleIconCard
    title="Client Side"
    description="Learn how to interact with x402-compatible APIs from your client applications"
    icon={TypeScriptIcon}
    href="/payments/x402/client"
  />
  <ArticleIconCard
    title="Server Side"
    description="Accept x402 payments in your APIs with middleware or dedicated endpoints"
    icon={EngineIcon}
    href="/payments/x402/server"
  />
  <ArticleIconCard
    title="Facilitator API"
    description="Configure the facilitator service to verify and settle payments"
    icon={EngineIcon}
    href="/payments/x402/facilitator"
  />
</div>