import { Tabs, TabsList, TabsTrigger, TabsContent } from "@/components/ui/tabs";
import { OpenApiEndpoint, createMetadata } from "@doc";

export const metadata = createMetadata({
  image: {
    title: "x402 Agents",
    icon: "payments",
  },
  title: "x402 Agents",
  description: "Easily create AI agents that can pay for any x402-compatible API calls.",
});

# x402 Agents

Easily create AI agents that can pay for any x402-compatible API calls.

## Using the MCP Server

The easiest way to equip your agents with the ability to pay for API calls is to use the [remote MCP server](/ai/mcp) and provide the tools to your agent.

The MCP server comes with all the tools by default, but you can filter the tools available by passing a comma-separated list of tools as a query parameter.

In this example, we create a ReAct agent using LangChain and filter the MCP tools to `fetchWithPayment` and `listDiscoveryResources` as the only 2 tools we give our agent. You can view the full list of available tools [here](/ai/mcp#available-tools).

<Tabs defaultValue="typescript">

<TabsList>
<TabsTrigger value="typescript">TypeScript</TabsTrigger>
<TabsTrigger value="python">Python</TabsTrigger>
</TabsList>

<TabsContent value="typescript">

```typescript
import { createReactAgent } from "@langchain/langgraph/prebuilt";
import { MultiServerMCPClient } from "@langchain/mcp-adapters";
import { ChatOpenAI } from "@langchain/openai";

const model = new ChatOpenAI({
  model: "gpt-4.1",
});

const mcpServers = {
  thirdweb: {
    url: `https://api.thirdweb.com/mcp?secretKey=<your-project-secret-key>&tools=fetchWithPayment,listDiscoveryResources`
  }
};

// Connect to MCP servers and get tools
const client = new MultiServerMCPClient(mcpServers);
const tools = await client.getTools();

const agent = createReactAgent({
  llm: model,
  tools: tools,
  prompt: "Use the fetchWithPayment tool to fetch any endpoint. Discover the available endpoints with the listDiscoveryResources tool."
});
```

</TabsContent>

<TabsContent value="python">

```python
from langchain_mcp_adapters.client import MultiServerMCPClient
from langgraph.prebuilt import create_react_agent

client = MultiServerMCPClient(
    {
        "thirdweb": {
            "url": "https://api.thirdweb.com/mcp?secretKey=<your-project-secret-key>&tools=fetchWithPayment,listDiscoveryResources",
        }
    }
)
tools = await client.get_tools()
agent = create_react_agent("openai:gpt-4.1", tools, prompt="Use the fetchWithPayment tool to fetch any endpoint. Discover the available endpoints with the listDiscoveryResources tool.")
```

</TabsContent>
</Tabs>

## Using the API directly

You can also create your own MCP tool or wrap all external calls with the `/v1/x402/fetchWithPayment` endpoint to automatically handle payment flows when APIs return a `402 Payment Required` response.

Pass the target `url`, `method`. By default, it will use your default project wallet for payments, but you can also pass an optional `from` wallet address to the endpoint that will complete the payment. The address should be one of your [user wallets](/wallets/users) or [server wallets](/wallets/server).

```bash
curl -X POST https://api.thirdweb.com/v1/payments/x402/fetch?url=https://api.example.com/premium&method=GET \
    -H "Content-Type: application/json" \
    -H "x-secret-key: <your-project-secret-key>" \
    -d '{ ... }' # optional request body passed through to the url called.
```

<OpenApiEndpoint path="/v1/payments/x402/fetch" method="POST" />

